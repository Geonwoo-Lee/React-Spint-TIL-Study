# TIL 2021 - 08 - 12  📖 !

# - sprint
- 수동 배포 과정 
  - EC2 (서버 배포 과정)
    1. AWS홈페이지에 들어가서 인스턴스를 생성한다 .
    2. 스프린트에서는 Ubuntu로 했으므로 Ubuntu 인스턴스를 나는 무료로 할 것 이기 때문에 프리티어로 선택한다 
    3. 키페어를 생성하고 이름을 정해주고 다운로드 한다 
    4. 만든 인스턴스의 이름을 정해준다(편하게 보기 위해)
    5. 내가 생성한 인스턴스를 클릭하고 연결을 눌러준다
    6. SSH 클라이언트를 선택하고 터미널에서 chmod 400 을 입력한뒤 소유자의 권한을 바꾸어준다 4 = 읽기 2 = 쓰기 1 = 실행 모든 권한을 주기 위해선 chmod 700 = (4+2+1)
    7. 그 뒤에 ssh 명령어를 통해 인스턴스에 접속한다 인스턴스 접속시 나오는 경고 메세지에는 yes를 입력하여 접속한다 .
    8. sudo apt update 를 사용하여 업데이트과정을 거친다
    9. nvm install node 노드를 설치해준다
    10. sudo apt install npm 으로 npm을 깔아준다
    11. git을 이용하여 서버 코드 클론을 받는다 .
    (클라이언트와 같은 레포를 사용해야하고 username과 password는 내가 fork 한 계정으로 해준다)
    12. 레포 내의 서버 폴더로 이동한다 .
    13. npm install 해준다
    14. sudo npm start 를 해준다 
    15. 다시 aws 홈페이지 인스턴스 상에서 보안그룹에 들어간뒤 인바운드 규칙을 설정 해준닫
    16. 인바운드 규칙 편집을 누른 후에 규칙 추가로 모든 ip에대해서 접속 허용으로 해준다 
    17. pm2를 설치해준다 .  다시 서버로 돌아와서  npm install pm2 -g 를 해준다 
    18. pm2 start 파일 이름 이것으로 node.js 이 명령어로 백그라운드에서 프로세스를 작동하게 할 수 있다 .
    19. authbind 설치
       - sudo apt-get update

       - sudo apt-get install authbind

       - sudo touch /etc/authbind/byport/80

       - sudo chown ubuntu /etc/authbind/byport/80

       - sudo chmod 755 /etc/authbind/byport/80

       - authbind --deep pm2 update
  - 클라이언트 배포 과정
     1. 서버와 같은 레포에서 env. 파일을 수정한다 서버의 주소를 APIURL GUDTLRDMFH http://를 포함하여 넣어준다 
     2. npm run build를 입력하여 빌드해준다 
     3. 빌드 폴더가 확인되면 aws홈페이지에서 s3를 검색하여 들어간뒤에 버킷을 만들어준다 .
     4. 버킷이름을 설정해주고 리전을 설정해준다 나는 서울에 있으니 서울리전을 사용하였다 그 뒤 버킷을 만들고 
     5. 만들어진 버킷의 속성 메뉴에 들어가 정적 웹사이트 호스팅 옵션을 활성화 시켜준다 .
     6. 그 뒤에 객체에 들어가서 업로드를 눌러 빌드 폴더에 있던 모든 파일들을 업로드 해준다 . 
     7. 그 뒤에 다시 버킷의 권한으로 들어가서 퍼블릭 엑세스 차단 편집을 눌러 모든 퍼블릭 엑세스차단을 해제한다 
     8. 버킷 정책에 들어가 편집을 누르고 정책 생성기를 눌러 정책을 생성한다.
     9. 정책생성의 policy 는 bucket policy를 선택하고 principal은 * 전체를 입력한뒤에 Actions에는 GetObject를 선택한뒤에 Amazon Resource Name 에는 arn:aws:s3:::버킷이름 / * 의형태로 사용하고 Add 버튼을 누른뒤에 떠있는 json 객체를 복사한뒤에  생성된 객체를 정책 생성기에 복사 붙혀넣기 하고 저장합니다 .
     10. 속성에 들어가서 정적 웹사이트 엔드포인트에 접속해 확인해본다 .

  - 데이터베이스 배포 과정 
      1. AWS 홈페이지에서 RDS 를 검색하여 이동한다 . 
      2. 데이터베이스를 클릭하고 데이터베이스 생성을 한다 .
      3. 나는 Mysql을 사용 할 것이니 엔진옵셥에서 mysql을 선택해 주고 프리티어로 설정해주고 식별자 이름 마스터사용자 이름과 암호 기재를 해준다 . 위 정보는 꼭 기억 해야한다
      4. 퍼블릭 엑세스도 가능하게 해준다 . 보안그룹은 default로 해주고 데이터베이스 포트번호는 포트번호 방지로 13306으로 해준다 .
      5. 추가 구성에서 데이터베이스 옵션에 초기 데이터베이스 이름을 서버에서 test로 해주었기 때문에 test로 설정해준다. 
      6.  데이터베이스 생성을 눌러주고 데이터베이스가 생성됨이 될 때 까지 기다린다 
      7. 생성되면 local환경에서 mysql.server start를 통해 서버를 실행해준 뒤에 
      8. 'mysql -u [마스터 이름] --host [엔드포인트 주소] -P 13306(포트번호) -p' 명령어를 입력합니다 . 
      9. 성공 하면 show databases 를 통해 test라는 데이터베이스가 보이면 성공이다 이때 애러가 발생하면 데이터베이스 보안그룹에서 보안 설정을 바꾸어준다 .
      10. 다시 서버환경에 들어가서 nano .env로 env파일을 수정해준다 
      - DATABASE_HOST 변수에는 생성한 DB 인스턴스의 엔드포인트 주소를 넣습니다.
      - DATABASE_USER 변수에는 마스터 사용자 이름을 넣습니다.
      - DATABASE_PASSWORD 변수에는 마스터 암호를 넣습니다.
      - DATABASE_PORT 에는 DB 인스턴스의 port 번호를 넣습니다.
      11. 그 뒤에 컨트롤 x 를 누르고 저장하고 y 엔터로 파일을 저장 한 뒤에 
      12. sudo npm start를 하면 끝입니다 . 
